"use strict";(self.webpackChunkjira=self.webpackChunkjira||[]).push([[934],{9934:function(e,n,t){t.r(n),t.d(n,{ColumnsContainer:function(){return ue},default:function(){return ce},useDragEnd:function(){return le}});var r=t(168),a=t(6499),i=t(43),l=t(1413),u=t(4925),c=t(2791),o=t(6292),d=["children"],m=["children"],s=["children"],f=function(e){var n=e.children,t=(0,u.Z)(e,d);return c.createElement(o.bK,t,(function(e){return c.isValidElement(n)?c.cloneElement(n,(0,l.Z)((0,l.Z)({},e.droppableProps),{},{ref:e.innerRef,provided:e})):c.createElement("div",null)}))},v=c.forwardRef((function(e,n){var t,r=e.children,a=(0,u.Z)(e,m);return c.createElement("div",{ref:n,style:{minHeight:"5px"}},r,null===(t=a.provided)||void 0===t?void 0:t.placeholder)})),p=function(e){var n=e.children,t=(0,u.Z)(e,s);return c.createElement(o._l,t,(function(e){return c.isValidElement(n)?c.cloneElement(n,(0,l.Z)((0,l.Z)((0,l.Z)({},e.draggableProps),e.dragHandleProps),{},{ref:e.innerRef})):c.createElement("div",null)}))},E=t(5728),k=t(5850),Z=t(1933),b=t(286),g=t(1582),y=function(e){var n=(0,b.i)();return(0,Z.useQuery)(["kanbans",e],(function(){return n("kanbans",{data:e})}))},h=function(e){var n=(0,b.i)();return(0,Z.useMutation)((function(e){return n("kanbans",{method:"POST",data:e})}),(0,g.HZ)(e))},I=function(e){var n=(0,b.i)();return(0,Z.useMutation)((function(e){var t=e.id;return n("kanbans/".concat(t),{method:"DELETE"})}),(0,g.kd)(e))},x=t(456),w=t(4165),C=t(5861),O=t(9439),P=t(2759),T=function(){var e=(0,b.i)();return(0,Z.useQuery)(["taskTypes"],(function(){return e("taskTypes")}))},A=t(9926);var R=t.p+"static/media/bug.06db5a45894297a73db906abf758f54f.svg";var j=t.p+"static/media/task.d2777a84971e1d82df2b66d12b63b2c4.svg",L=t(5109),F=t(7309);function S(e){var n=e.kanbanId,t=(0,c.useState)(""),r=(0,O.Z)(t,2),a=r[0],i=r[1],l=(0,c.useState)(!1),u=(0,O.Z)(l,2),o=u[0],d=u[1],m=(0,A.OP)(),s=(0,x.G8)((0,A.wE)()).mutateAsync,f=function(){var e=(0,C.Z)((0,w.Z)().mark((function e(){return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s({projectId:m,kanbanId:n,name:a});case 2:d(!1),i("");case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,c.useEffect)((function(){o||i("")}),[o]),c.createElement("div",null,o?c.createElement(L.Z,{style:{marginBottom:"0.5rem"}},c.createElement(P.Z,{placeholder:"\u9700\u8981\u505a\u4e9b\u4ec0\u4e48",value:a,onChange:function(e){return i(e.target.value)},onPressEnter:f})):c.createElement(F.ZP,{type:"link",onClick:function(){return d(!0)}},"+\u521b\u5efa\u4e8b\u52a1"))}function W(e){var n=e.name,t=(0,A.et)().name;if(!t)return c.createElement(c.Fragment,null,n);var r=n.split(t);return console.log(r,"1",n,2,t,3),c.createElement(c.Fragment,null,r.map((function(e,n){return c.createElement("span",{key:n},e,n===r.length-1?null:c.createElement("span",{style:{color:"#257AFD"}},t))})))}var X,D,K=t(5572),M=t(294),N=t(3099);function V(e){var n=e.kanbanId,t=I((0,A.RW)()).mutateAsync,r=[{key:"delete",label:c.createElement(F.ZP,{type:"link",onClick:function(){K.Z.confirm({okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",title:"\u786e\u5b9a\u5220\u9664\u770b\u677f\u5417?",onOk:function(){t({id:n})}})}},"\u5220\u9664")}];return c.createElement(M.Z,{menu:{items:r}},c.createElement(F.ZP,{type:"link",onClick:function(e){return e.preventDefault}},c.createElement(N.Z,null,"...")))}var z=["kanban"],B=c.forwardRef((function(e){var n=e.task,t=(0,A.A_)().startEdit;return c.createElement(L.Z,{style:{marginBottom:"0.5rem",cursor:"pointer"},key:n.id,onClick:function(){return t(n.id)}},c.createElement(W,{name:n.name}),c.createElement(G,{id:n.typeId}))})),_=c.forwardRef((function(e,n){var t=e.kanban,r=(0,u.Z)(e,z),a=(0,x.Xi)((0,A.et)()).data,i=null===a||void 0===a?void 0:a.filter((function(e){return e.kanbanId===t.id}));return c.createElement(H,Object.assign({ref:n},r),c.createElement(E.X2,{bettween:!0},c.createElement("h2",null,t.name),c.createElement(V,{kanbanId:t.id,key:t.id})),c.createElement(q,null,c.createElement(f,{type:"ROW",direction:"vertical",droppableId:String(t.id)},c.createElement(v,null,null===i||void 0===i?void 0:i.map((function(e,n){return c.createElement(p,{key:e.id,index:n,draggableId:"task"+e.id},c.createElement("div",null,c.createElement(B,{task:e,key:e.id})))})))),c.createElement(S,{kanbanId:t.id})))})),G=function(e){var n,t=e.id,r=T().data,a=null===r||void 0===r||null===(n=r.find((function(e){return e.id===t})))||void 0===n?void 0:n.name;return a?c.createElement("img",{src:"task"===a?j:R,alt:"\u7c7b\u578b\u56fe\u6807",style:{width:"16px"}}):null},H=a.Z.div(X||(X=(0,r.Z)(["\n  min-width: 27rem;\n  border-radius: 6px;\n  background-color: rgb(244, 245, 247);\n  display: flex;\n  flex-direction: column;\n  padding: 0.7rem;\n  margin-right: 1.5rem;\n"]))),q=a.Z.div(D||(D=(0,r.Z)(["\n  overflow: scroll;\n  flex: 1;\n  ::-webkit-scrollbar {\n    display: none;\n  }\n"])));function Q(){var e=(0,c.useState)(""),n=(0,O.Z)(e,2),t=n[0],r=n[1],a=(0,A.OP)(),i=h((0,A.RW)()).mutateAsync,l=function(){var e=(0,C.Z)((0,w.Z)().mark((function e(){return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i({name:t,projectId:a});case 2:r("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return c.createElement(H,null,c.createElement(P.Z,{size:"large",placeholder:"\u65b0\u5efa\u770b\u677f\u540d\u79f0",onPressEnter:l,value:t,onChange:function(e){return r(e.target.value)}}))}var U=t(2132),J=function(e){var n=T().data;return c.createElement(U.Z,Object.assign({options:n||[]},e))},Y=t(6610),$=t(1652);function ee(){var e=(0,A.et)(),n=(0,$.G)();return c.createElement(E.X2,{gap:!0,style:{marginBottom:"3.6rem"}},c.createElement(P.Z,{style:{width:"20rem"},placeholder:"\u4efb\u52a1\u540d",value:e.name,onChange:function(e){return n({name:e.target.value})}}),c.createElement(Y.Z,{defaultOptionName:"\u7ecf\u529e\u4eba",value:e.processorId,onChange:function(e){return n({processorId:e})}}),c.createElement(J,{defaultOptionName:"\u9879\u76ee\u7c7b\u578b",value:e.typeId,onChange:function(e){return n({typeId:e})}}),c.createElement(F.ZP,{onClick:function(){n({typeId:void 0,processorId:void 0,tagId:void 0,name:void 0})}},"\u6e05\u9664\u7b5b\u9009\u5668"))}var ne,te=t(4183),re=t(4086);function ae(){var e=(0,re.Z)(),n=(0,O.Z)(e,1)[0],t=(0,A.A_)(),r=t.editingTask,a=t.editingTaskId,i=t.close,u=(0,x.G1)((0,A.wE)()),o=u.mutateAsync,d=(u.isLoading,function(){var e=(0,C.Z)((0,w.Z)().mark((function e(){return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o((0,l.Z)((0,l.Z)({},r),n.getFieldsValue()));case 2:i();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()),m=(0,x.Fq)((0,A.wE)()).mutateAsync;return(0,c.useEffect)((function(){n.setFieldsValue(r)}),[r,n]),c.createElement(K.Z,{open:!!a,okText:"\u786e\u5b9a",cancelText:"\u53d6\u6d88",onCancel:function(){n.resetFields(),i()},onOk:d,title:"\u7f16\u8f91\u4efb\u52a1"},c.createElement(te.Z,Object.assign({},{labelCol:{span:8},wrapperCol:{span:16}},{form:n,initialValues:r}),c.createElement(te.Z.Item,{label:"\u4efb\u52a1\u540d",name:"name",rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u4efb\u52a1\u540d"}]},c.createElement(P.Z,null)),c.createElement(te.Z.Item,{label:"\u7ecf\u529e\u4eba",name:"processorId"},c.createElement(Y.Z,null)),c.createElement(te.Z.Item,{label:"\u7c7b\u578b",name:"typeId"},c.createElement(J,null)),c.createElement("div",{style:{textAlign:"right"}},c.createElement(F.ZP,{type:"link",size:"small",onClick:function(){K.Z.confirm({okText:"\u786e\u5b9a?",cancelText:"\u53d6\u6d88",onOk:function(){var e=(0,C.Z)((0,w.Z)().mark((function e(){return(0,w.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m({id:Number(a)});case 2:i();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),title:"\u786e\u5b9a\u5220\u9664\u4efb\u52a1\u5417"})}},"\u5220\u9664"))))}var ie=(0,c.memo)((function(){(0,k.jr)("\u770b\u677f\u5217\u8868");var e=y((0,A.LK)()),n=e.data,t=e.isLoading,r=(0,A.BA)().data,a=(0,x.Xi)((0,A.et)()).isLoading||t,l=le();return c.createElement(o.Z5,{onDragEnd:l},c.createElement(E.X_,null,c.createElement("h1",null,null===r||void 0===r?void 0:r.name,"\u770b\u677f"),c.createElement(ee,null),a?c.createElement(i.Z,{size:"large"}):c.createElement(f,{type:"COLUMN",direction:"horizontal",droppableId:"kanban"},c.createElement(ue,null,c.createElement(v,null,c.createElement("div",{style:{display:"flex",height:"100% "}},null===n||void 0===n?void 0:n.map((function(e,n){return c.createElement(p,{key:e.id,draggableId:"kanban"+e.id,index:n},c.createElement(_,{kanban:e}))})))),c.createElement(Q,null))),c.createElement(ae,null)))})),le=function(){var e=y((0,A.LK)()).data,n=function(e){var n=(0,b.i)();return(0,Z.useMutation)((function(e){return n("kanbans/reorder",{data:e,method:"POST"})}),(0,g.c1)(e))}((0,A.RW)()).mutate,t=(0,x.Wi)((0,A.wE)()).mutate,r=(0,x.Xi)((0,A.et)()).data,a=void 0===r?[]:r;return(0,c.useCallback)((function(r){var i=r.source,l=r.destination,u=r.type;if(l){if("COLUMN"===u){var c=null===e||void 0===e?void 0:e[i.index].id,o=null===e||void 0===e?void 0:e[l.index].id;if(!c||!o||c===o)return;var d=l.index>i.index?"after":"before";n({fromId:c,referenceId:o,type:d})}if("ROW"===u){var m=+i.droppableId,s=+l.droppableId,f=a.filter((function(e){return e.kanbanId===m}))[i.index],v=a.filter((function(e){return e.kanbanId===s}))[l.index];if((null===f||void 0===f?void 0:f.id)===(null===v||void 0===v?void 0:v.id))return;t({fromId:null===f||void 0===f?void 0:f.id,referenceId:null===v||void 0===v?void 0:v.id,fromKanbanId:m,toKanbanId:s,type:m===s&&l.index>i.index?"after":"before"})}}}),[e,n,a,t])},ue=a.Z.div(ne||(ne=(0,r.Z)(["\n  display: flex;\n  overflow-x: scroll;\n  flex: 1;\n"]))),ce=ie}}]);
//# sourceMappingURL=934.ca9f2d2e.chunk.js.map